M_uid = 'XXXXXXXXXX'
M_Hid = '1000000001'

** HPLANET IS INDEXED ON UID + HID + PLANET

SELECT 1
USE C:\TEMP\HPLANET
SET INDEX TO C:\TEMP\HPLANET
SET FILTER TO uid = "XXXXXXXXXX" AND hid = "1000000001"

SELECT 2
USE C:\TEMP\HCUSP
SET FILTER TO uid = "XXXXXXXXXX" AND hid = "1000000001"

** CUSP IS INDEXED ON UID + HID + CUSPID
SELECT 3
USE C:\TEMP\cusp

** hrake IS INDEXED ON uID + HID + PLANET

SELECT 4
USE C:\TEMP\HRAKE

SELECT 5
USE C:\TEMP\MATCH_FILE

** match_summ IS INDEX ON UID + HID + KEY TO C:\TEMP\MATCH_SUMM

SELECT 6
USE C:\TEMP\MATCH_SUMM


INDEX ON UID + HID + KEY TO C:\TEMP\MATCH_SUMM

ST1 = ""
ST2 = ""
ST3 = ""
ST4 = ""
ST5 = ""
ST6 = ""
ST7 = ""
ST8 = ""
ST9 = ""
ST10 = ""
ST11 = ""
ST12 = ""

SELECT 2
GO TOP

DO WHILE NOT EOF()
	STORE UID TO M_uid
	store hid to m_hid
	IF CUSP = '01'
		ST1 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '02'
		ST2 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '03'
		ST3 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '04'
		ST4 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '05'
		ST5 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '06'
		ST6 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '07'
		ST7 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '08'
		ST8 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '09'
		ST9 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '10'
		ST10 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '11'
		ST11 = CP1+CP2+CP3
	ENDIF
	IF CUSP = '12'
		ST12 = CP1+CP2+CP3
	ENDIF
	WAIT
	select 2
	skip
enddo

SELECT 1
GO TOP

DO WHILE NOT EOF()
	IF hphouse = '01'
		FL = CHECKSTR(ST1,PLANET)
		IF  FL = FALSE
			ST1 = ST1 + PLANET
		ENDIF	
	ENDIF
	
	IF hphouse = '02'
		FL = CHECKSTR(ST2,PLANET)
		IF  FL = FALSE
			ST2 = ST2 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '03'
		FL = CHECKSTR(ST3,PLANET)
		IF  FL = FALSE
			ST3 = ST3 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '04'
		FL = CHECKSTR(ST4,PLANET)
		IF  FL = FALSE
			ST4 = ST4 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '05'
		FL = CHECKSTR(ST5,PLANET)
		IF  FL = FALSE
			ST5 = ST5 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '06'
		FL = CHECKSTR(ST6,PLANET)
		IF  FL = FALSE
			ST6 = ST6 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '07'
		FL = CHECKSTR(ST7,PLANET)
		IF  FL = FALSE
			ST7 = ST7 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '08'
		FL = CHECKSTR(ST8,PLANET)
		IF  FL = FALSE
			ST8 = ST8 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '09'
		FL = CHECKSTR(ST9,PLANET)
		IF  FL = FALSE
			ST9 = ST9 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '10'
		FL = CHECKSTR(ST10,PLANET)
		IF  FL = FALSE
			ST10 = ST10 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '11'
		FL = CHECKSTR(ST11,PLANET)
		IF  FL = FALSE
			ST11 = ST11 + PLANET
		ENDIF	
	ENDIF
	IF hphouse = '12'
		FL = CHECKSTR(ST1,PLANET)
		IF  FL = FALSE
			ST12 = ST12 + PLANET
		ENDIF	
	ENDIF

	WAIT

	select 1
	skip
enddo

SELECT 3

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '01'
REPLACE S1 WITH ST1

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '02'
REPLACE S1 WITH ST2

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '03'
REPLACE S1 WITH ST3

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '04'
REPLACE S1 WITH ST4

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '05'
REPLACE S1 WITH ST5

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '06'
REPLACE S1 WITH ST6

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '07'
REPLACE S1 WITH ST7

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '08'
REPLACE S1 WITH ST8

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '09'
REPLACE S1 WITH ST9

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '10'
REPLACE S1 WITH ST10

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '11'
REPLACE S1 WITH ST11

WAIT

APPE BLANK
REPLACE UID WITH 'XXXXXXXXXX'
REPLACE hID WITH '1000000001'
REPLACE CUSPID WITH '12'

REPLACE S1 WITH ST12

** READ RHU AND KETU

FR1 = ""
FK1 = ""

SELECT 1
SEEK M_UID + M_HID + 'RA'
STORE HP1 TO R1
STORE HP2 TO R2

SEEK M_UID + M_HID + 'KE'
STORE HP1 TO K1
STORE HP2 TO K2

? "reaD FROM HPLANET"
? R1,R2,K1,K2
WAIT

FLX = CHECKSTR(FR1,R1)
IF FLX = FALSE AND R1 <> 'RA'
	FR1 = FR1 + R1
ENDIF
? "ADD R1 TO FR1"
? FR1

WAIT 

FLKX = CHECKSTR(FR1,R2)
IF FLX = FALSE AND R1 <> 'RA'
	FR1 = FR1 + R2
ENDIF

? "ADD R2 TO FR1"
? FR1

WAIT 

FLX = CHECKSTR(FK1,K1)
IF FLX = FALSE AND K1 <> 'KE'
	FK1 = FK1 + K1
ENDIF

? "ADD K1 TO FK1"
? FK1

WAIT 

FLX = CHECKSTR(FK1,K2)
IF FLX = FALSE AND K1 <> 'KE'
	FK1 = FK1 + K2
ENDIF

? "ADD K2 TO FK1"
? FK1

WAIT

** CHECK FOR RA AND KE AS DUPLICATES

FLX = CHECKSTR(FR1,"KE")
IF FLX = TRUE
		? 'KE FOUND IN FR1'
		FLX = CHECKSTR(FR1,K1)
		IF FLX = FALSE AND K1 <> 'RA'
				? 'RA NOT IN KE SO ADDING' + " " + R1
				FR1 = FR1 + K1
		ENDIF
		FLX = CHECKSTR(FR1,K2)
		IF FLX = FALSE AND K2 <> 'RA'
				? 'RA NOT IN KE SO ADDING' + " " + R2
				FR1 = FR1 + K2
		ENDIF
ENDIF


FLX = CHECKSTR(FK1,"RA")
IF FLX = TRUE
		? 'RA FOUND IN FK1'
		FLX = CHECKSTR(FK1,R1)
		IF FLX = FALSE AND R1 <> 'KE'
				? 'KE NOT IN RA SO ADDING K1' + " " + K1
				FK1 = FK1 + R1
		ENDIF
		IF FLX = FALSE AND R2 <> 'KE'
				? 'KE NOT IN RA SO ADDING K2' + " " + K2
				FK1 = FK1 + R2
		ENDIF
ENDIF

SELECT 4
APPE BLANK
REPLACE HID WITH M_hid
REPLACE UID WITH M_UID
REPLACE KEY WITH 'RA'
REPLACE S1 WITH FR1

APPE BLANK
REPLACE HID WITH M_hid
REPLACE UID WITH M_UID
REPLACE KEY WITH 'KE'
REPLACE S1 WITH FK1

cLOSE ALL

FUNCTION CHECKSTR(S,P)
X = LEN(S)/2
OV = FALSE
START = 1
FOR I = 1 TO X	
	IF SUBSTR(S,START,2) = P
		OV = TRUE
		EXIT
	ENDIF
	START = START + 2
ENDFOR
RETURN OV
W